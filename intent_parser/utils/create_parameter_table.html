<!DOCTYPE html>
<html>
<body>
  <script>
    function onSuccess() {
        google.script.host.close();
    }
    function handleCancel() {
        google.script.host.close();
    }
    function handleSubmit() {
        var table = document.getElementById('parameterTable');

        var extra = {"action": "createParameterTable"};
        var theForm = this.createParameterTableForm;
        var formInfo = {'cursorChildIndex' : theForm.cursorChildIndex.value,
                        'formName' : theForm.formName.value,
                        'protocol' : theForm.protocols.value
                        };
        formInfo.extra = extra;
        google.script.run.withSuccessHandler(onSuccess).submitForm(formInfo);
    }

    function resetTableOptions(table){
        // Remove existing information
        while (table.rows.length > 0) {
            table.deleteRow(table.rows.length - 1);
        }
    }

    function populateTableOptions(table, listOfOptions){
        for (index = 0; index < listOfOptions.length; index++) {
            var row = table.insertRow(index);
            var checkBoxCell = row.insertCell(0);
            var optionalFieldTextCell = row.insertCell(1);
            checkBoxCell.innerHTML = "<td><input type='checkbox' id='chk_"+i+"' /></td>";
            optionalFieldTextCell.innerHTML = listOfOptions[index];
        }
    }

    function showOptionalFields(){
      var selectedProtocol = theForm.protocols
      var table = document.getElementById('parameterFieldOptionsTable');
      resetTableOptions(table);
      if (selectedProtocol == 'Growth Curves'){
          populateTableOptions(table, this.timeseriesParameterOptions)
      }
      else if(selectedProtocol == 'Time Series'){
          populateTableOptions(table, this.growthCurveParameterOptions)
      }
      else if(selectedProtocol == 'Obstacle Course'){
          populateTableOptions(table, this.obstacleCourseParameterOptions)
      }
    }

    this.timeseriesParameterOptions = "${TIMESERIESPARAMETEROPTIONS}"
    this.growthCurveParameterOptions = "${GROWTHCURVEPARAMETEROPTIONS}"
    this.obstacleCourseParameterOptions = "${OBSTACLECOURSEPARAMETEROPTIONS}"
  </script>
  <center>
    <form name="createParameterTableForm" action="/add">
      <input type="hidden" name="cursorChildIndex" value="${CURSOR_CHILD_INDEX}">
      <input type="hidden" name="formName" value="createParameterTable">
      <table stype="width:600px">
        <tr>
          <th align="right">Protocol: </th>
          <td align="left">
            <select id="protocol_opt" name="protocols" onChange=showOptionalFields()>${PROTOCOLOPTIONS}</select>
          </td>
        </tr>

        <tr style="width:250px">
          <td colspan="2">
            <table id="parameterFieldOptionsTable" stype="width:100%"></table>
          </td>
        </tr>
      </table>
      <input type="button" value="Submit" id="submitButton" title="Submit form and generate a parameter table template." onclick="handleSubmit()">
      <input type="button" value="Cancel" id="cancelButton" onclick="handleCancel()">
    </form>
  </center>
</body>
</html>
